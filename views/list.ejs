<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Danh S√°ch H·ªì S∆°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-gray-100 to-white min-h-screen">
  <!-- Kh·ªëi T√†i kho·∫£n nh·ªè g·ªçn (ƒë·ªôc l·∫≠p) -->
  <div class="max-w-md mx-auto mt-12 p-6 bg-white rounded-xl shadow-xl border border-gray-200">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-bold text-indigo-600">
        <i class="fas fa-money-bill-wave mr-2 text-green-500"></i>T√†i Kho·∫£n
      </h2>
      <span class="<%= account.balance > 0 ? 'text-green-600' : account.balance < 0 ? 'text-red-600' : 'text-gray-800' %> text-lg font-semibold">
        <%= account.balance.toLocaleString() %> VNƒê
      </span>
    </div>
    <div class="mt-4 flex flex-col gap-2">
      <button id="toggleUpdateAccountForm" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow transition">
        <i class="fas fa-edit mr-2"></i>C·∫≠p nh·∫≠t t√†i kho·∫£n
      </button>
      <button id="toggleAccountHistory" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg shadow transition">
        <i class="fas fa-history mr-2"></i>Xem l·ªãch s·ª≠ c·∫≠p nh·∫≠t
      </button>
    </div>
    <!-- Form c·∫≠p nh·∫≠t t√†i kho·∫£n (·∫©n m·∫∑c ƒë·ªãnh) -->
    <div id="updateAccountForm" class="mt-4 hidden">
      <form action="/update-account" method="POST" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">S·ªë ti·ªÅn</label>
          <input name="amount" type="number" step="1000" required placeholder="Nh·∫≠p s·ªë ti·ªÅn" 
                 class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Lo·∫°i thao t√°c</label>
          <select name="type" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400">
            <option value="add">‚ûï Th√™m ti·ªÅn</option>
            <option value="subtract">‚ûñ Tr·ª´ ti·ªÅn</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">L√Ω do ch·ªânh s·ª≠a</label>
          <input name="reason" type="text" placeholder="L√Ω do ch·ªânh s·ª≠a" 
                 class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400" />
        </div>
        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg shadow transition w-full">
          <i class="fas fa-paper-plane mr-2"></i>G·ª≠i c·∫≠p nh·∫≠t
        </button>
      </form>
    </div>
    <!-- Kh·ªëi l·ªãch s·ª≠ c·∫≠p nh·∫≠t t√†i kho·∫£n (·∫©n m·∫∑c ƒë·ªãnh) -->
    <div id="accountHistory" class="mt-4 hidden">
      <% if (account.history && account.history.length > 0) { %>
        <h3 class="text-sm font-semibold text-gray-700 mb-2">üïò L·ªãch s·ª≠ giao d·ªãch</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full text-xs text-gray-600">
            <thead>
              <tr class="bg-gray-100 text-left">
                <th class="px-2 py-1">Th·ªùi gian</th>
                <th class="px-2 py-1">Lo·∫°i</th>
                <th class="px-2 py-1">S·ªë ti·ªÅn</th>
                <th class="px-2 py-1">L√Ω do</th>
              </tr>
            </thead>
            <tbody>
              <% account.history.slice().reverse().forEach(item => { %>
                <tr class="border-t">
                  <td class="px-2 py-1"><%= new Date(item.date).toLocaleString() %></td>
                  <td class="px-2 py-1 font-bold <%= item.type === 'add' ? 'text-green-600' : 'text-red-600' %>">
                    <%= item.type === 'add' ? 'Th√™m' : 'Tr·ª´' %>
                  </td>
                  <td class="px-2 py-1 <%= item.type === 'add' ? 'text-green-600' : 'text-red-600' %>">
                    <%= item.amount.toLocaleString() %> VNƒê
                  </td>
                  <td class="px-2 py-1 italic"><%= item.reason %></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="text-sm text-gray-500">Ch∆∞a c√≥ giao d·ªãch.</p>
      <% } %>
    </div>
  </div>

  <!-- N·ªôi dung ch√≠nh: Danh s√°ch h·ªì s∆° -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <h1 class="text-4xl font-bold text-center text-indigo-700 mb-10">
      <i class="fas fa-folder-open mr-2"></i>Danh S√°ch H·ªì S∆° Kh√°ch H√†ng
    </h1>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
      <% profiles.forEach(profile => { %>
        <div class="block bg-white rounded-2xl shadow-md hover:shadow-xl transition duration-300 transform hover:-translate-y-1 overflow-hidden border border-gray-100">
          <!-- S·ª≠ d·ª•ng avatar n·∫øu t·ªìn t·∫°i, n·∫øu kh√¥ng th√¨ d√πng default-avatar.png -->
          <a href="/profile/<%= profile._id %>">
            <img 
              src="/uploads/<%= profile.avatar ? profile.avatar : 'default-avatar.png' %>" 
              alt="Avatar" 
              class="w-full h-52 object-cover"
              onerror="this.onerror=null;this.src='/uploads/default-avatar.png';"
            >
            <div class="p-5">
              <div class="flex items-center justify-between">
                <h2 class="text-xl font-semibold text-gray-800 truncate">
                  <i class="fas fa-user-circle text-indigo-500 mr-2"></i> <%= profile.name %>
                </h2>
                <% if (profile.paid) { %>
                  <span class="bg-green-100 text-green-700 text-xs font-semibold px-3 py-1 rounded-full shadow-sm">
                    <i class="fas fa-check-circle mr-1"></i> ƒê√£ tr·∫£
                  </span>
                <% } else { %>
                  <span class="bg-red-100 text-red-600 text-xs font-semibold px-3 py-1 rounded-full shadow-sm">
                    <i class="fas fa-exclamation-circle mr-1"></i> Ch∆∞a tr·∫£
                  </span>
                <% } %>
              </div>
              <p class="text-gray-500 mt-2 text-sm">
                <i class="fas fa-map-marker-alt text-gray-400 mr-1"></i><%= profile.address %>
              </p>
              <p class="text-sm text-gray-600 mt-1">
                <i class="far fa-calendar-alt text-indigo-400 mr-1"></i><%= profile.daysLeftText %>
              </p>
              <div class="mt-4 text-xs text-gray-400">
                <p><i class="far fa-calendar-plus mr-1"></i> T·∫°o: <%= new Date(profile.createdAt).toLocaleString() %></p>
                <p><i class="far fa-clock mr-1"></i> C·∫≠p nh·∫≠t: <%= new Date(profile.updatedAt).toLocaleString() %></p>
              </div>
            </div>
          </a>
        </div>
      <% }) %>
    </div>

    <% if (profiles.length === 0) { %>
      <div class="text-center mt-10 text-gray-500 italic">
        <i class="fas fa-folder-open text-3xl mb-2"></i><br>
        Kh√¥ng t√¨m th·∫•y h·ªì s∆° n√†o.
      </div>
    <% } %>

    <div class="text-center mt-12">
      <a href="/" class="inline-flex items-center text-indigo-600 font-medium hover:underline">
        <i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i trang t·∫°o h·ªì s∆°
      </a>
    </div>
  </div>

  <!-- JavaScript Toggle cho form c·∫≠p nh·∫≠t v√† l·ªãch s·ª≠ t√†i kho·∫£n -->
  <script>
    // Toggle form c·∫≠p nh·∫≠t s·ªë ti·ªÅn
    document.getElementById("toggleUpdateAccountForm").addEventListener("click", function(){
      var updateForm = document.getElementById("updateAccountForm");
      updateForm.classList.toggle("hidden");
      // ·∫®n l·ªãch s·ª≠ n·∫øu form m·ªü
      document.getElementById("accountHistory").classList.add("hidden");
    });

    // Toggle l·ªãch s·ª≠ t√†i kho·∫£n
    document.getElementById("toggleAccountHistory").addEventListener("click", function(){
      var historyEl = document.getElementById("accountHistory");
      historyEl.classList.toggle("hidden");
      // ·∫®n form c·∫≠p nh·∫≠t n·∫øu l·ªãch s·ª≠ m·ªü
      document.getElementById("updateAccountForm").classList.add("hidden");
    });
  </script>
</body>
</html>
